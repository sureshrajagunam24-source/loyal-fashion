<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loyal Fashion - Premium Store</title>
<style>
:root { --primary: #ff3f6c; --dark: #282c3f; --light: #f5f5f6; }
body{background:#fff;font-family:'Segoe UI', sans-serif;margin:0; overflow-x: hidden; color: var(--dark);}

/* HEADER */
.header{background:#fff; padding:10px 50px; display:flex; align-items:center; justify-content:space-between; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.05);}

/* Desktop-la top-bar-mobile row thevai illa, so adhai flex-ah maintain panrom */
.top-bar-mobile { display: contents; } 

.logo-section { display:flex; align-items:center; gap:12px; cursor: pointer; }
.logo-section b { font-size: 20px; color: #000; text-transform: uppercase; }

/* SEARCH BAR */
.search-container { background: var(--light); padding: 8px 15px; border-radius: 4px; display: flex; align-items: center; width: 350px; border: 1px solid #eee; }
.search-container input { background: none; border: none; outline: none; width: 100%; font-size: 13px; }
.search-lens { width: 18px; height: 18px; cursor: pointer; opacity: 0.6; }

/* CATEGORY NAV */
.nav-links { display: flex; gap: 25px; font-weight: bold; font-size: 14px; }
.nav-links span { cursor: pointer; padding: 10px 0; transition: 0.3s; border-bottom: 2px solid transparent;}
.nav-links span:hover, .nav-links span.active { color: var(--primary); border-bottom: 2px solid var(--primary); }

.action-icons { display: flex; align-items: center; gap: 20px; }
.icon-btn { text-align: center; cursor: pointer; position: relative; font-size: 12px; font-weight: bold; }
.avatar-circle { width:32px; height:32px; background:var(--dark); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:16px; margin: 0 auto; }

/* PRODUCT GRID */
.product-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:30px; padding:40px 50px;}
.product-card{background:#fff; text-align:left; transition: 0.3s; cursor: pointer; border: 1px solid transparent; position: relative;}
.product-card:hover { border: 1px solid #eee; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
.product-card img{width:100%; height:320px; object-fit:cover; border-radius:4px;}

.out-of-stock-badge { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); background: rgba(220, 53, 69, 0.9); color: white; padding: 10px 20px; font-weight: bold; font-size: 18px; border-radius: 4px; z-index: 10; width: 80%; text-align: center; pointer-events: none;}
.dim-image { opacity: 0.5; filter: grayscale(100%); }
.disabled-btn { background: #ccc !important; color: #666 !important; cursor: not-allowed !important; border: none !important; }

.product-info { padding: 15px; }
.rating-badge { background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-bottom: 5px; display: inline-block; }

.btn-group { display: flex; flex-direction: column; gap: 5px; margin-top: 10px; }
.cart-add-btn { background: #fff; color: var(--dark); border: 1px solid #d4d5d9; padding: 10px; font-weight: bold; cursor: pointer; }
.buy-now-btn { background: var(--dark); color: #fff; border: none; padding: 12px; font-weight: bold; cursor: pointer; }

/* SIDEBAR & MODAL */
#profileSidebar { position: fixed; top: 0; right: -100%; width: 300px; height: 100%; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); z-index: 4000; transition: 0.4s; padding: 25px; }
.sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3500; }
.modal { display:none; position:fixed; top:30%; left:50%; transform:translateX(-50%); background:white; padding:25px; border-radius:8px; box-shadow:0 10px 25px rgba(0,0,0,0.2); z-index: 3000; width: 300px;}
#cartCount { background: var(--primary); color: white; padding: 2px 6px; border-radius: 50%; font-size: 10px; position: absolute; top: -8px; right: 5px; }

/* =========================================
   ULTIMATE MOBILE UI: LOGO LEFT, ICONS RIGHT üì±
   ========================================= */
@media (max-width: 768px) {
    html, body { overflow-x: hidden; width: 100vw; margin: 0; padding: 0; }
    .header { flex-direction: column; padding: 10px; gap: 10px; }

    /* Logo and Icons in one row */
    .top-bar-mobile {
        display: flex !important;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        order: 1;
    }

    .logo-section { margin: 0; gap: 8px; }
    .logo-section b { font-size: 15px; }

    .action-icons {
        display: flex;
        gap: 12px;
        align-items: center;
        order: initial;
    }

    /* Name maraikka and icons align panna */
    #userName { display: none; }
    .icon-btn { font-size: 10px; text-align: center; min-width: 40px; }
    .avatar-circle { margin: 0 auto 2px; width: 28px; height: 28px; font-size: 14px; }

    /* Search bar keela full width */
    .search-container { 
        order: 2; 
        width: 100%; 
        margin: 5px 0;
        box-sizing: border-box;
    }

    /* Categories kadasila */
    .nav-links { 
        order: 3; 
        width: 100%; 
        justify-content: space-between; 
        gap: 5px;
        font-size: 12px;
        padding-top: 5px;
        border-top: 1px solid #eee;
    }

    .product-grid { 
        padding: 15px 10px; 
        grid-template-columns: repeat(2, 1fr); 
        gap: 10px; 
    }
    .product-card img { height: 180px; }
    #profileSidebar { width: 85%; }
}
</style>
</head>

<body>

<div class="header">
    <div class="top-bar-mobile">
        <div class="logo-section" onclick="location.reload()">
            <img src="image.png" alt="Logo" width="35" style="border-radius:50%">
            <b>LOYAL FASHION</b>
        </div>

        <div class="action-icons">
            <div class="icon-btn" id="loginBtn" onclick="openLogin()">üë§<br>Login</div>
            <div class="icon-btn" id="userInfo" style="display:none;" onclick="openProfile()">
                <div class="avatar-circle" id="userLetter"></div>
                <span id="userName">Profile</span>
            </div>
            <div class="icon-btn" onclick="window.location.href='wishlist.html'">‚ù§Ô∏è<br>Wishlist</div>
            <div class="icon-btn" onclick="window.location.href='cart.html'">üõí<span id="cartCount">0</span><br>Cart</div>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="Search for products...">
        <img src="https://cdn-icons-png.flaticon.com/512/149/149852.png" class="search-lens">
    </div>

    <div class="nav-links">
        <span onclick="filterCategory('ALL')">ALL</span>
        <span onclick="filterCategory('MEN')">MEN</span>
        <span onclick="filterCategory('WOMEN')">WOMEN</span>
        <span onclick="filterCategory('KIDS')">KIDS</span>
    </div>
</div>

<div class="product-grid" id="product-list"></div>

<div class="sidebar-overlay" id="overlay" onclick="closeProfile()"></div>
<div id="profileSidebar">
    <button onclick="closeProfile()" style="float:right; border:none; background:none; font-size:20px; cursor:pointer;">‚úñ</button>
    <div style="text-align:center; margin-top:30px;"><div id="sideLetter" style="width:60px; height:60px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:bold; margin:0 auto;"></div></div>
    <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
    <input type="text" id="sideName" placeholder="Full Name" style="width:90%; padding:10px; margin-bottom:10px;">
    <input type="number" id="sideMobile" placeholder="Mobile" style="width:90%; padding:10px; margin-bottom:10px;">
    <textarea id="sideAddress" rows="3" placeholder="Address" style="width:90%; padding:10px; margin-bottom:10px;"></textarea>
    <button onclick="saveProfile()" style="background:var(--primary); color:white; border:none; padding:12px; width:100%; font-weight:bold; cursor:pointer;">SAVE DETAILS</button>
    <button onclick="window.location.href='my-orders.html'" style="width:100%; background:#000; color:#fff; margin-top:10px; padding:10px; border:none; cursor:pointer;">üì¶ MY ORDERS</button>
    <button onclick="auth.signOut().then(()=>location.reload())" style="margin-top:20px; color:red; background:none; border:none; cursor:pointer; width:100%;">Logout</button>
</div>

<div class="modal" id="loginBox">
    <h3 id="auth-title">Login</h3>
    <input type="email" id="email" placeholder="Email" style="width:90%; padding:10px; margin-bottom:10px;">
    <input type="password" id="password" placeholder="Password" style="width:90%; padding:10px; margin-bottom:10px;">
    <button id="auth-btn" onclick="handleAuth()" style="width:100%; background:var(--primary); color:white; border:none; padding:12px; cursor:pointer; font-weight:bold;">CONTINUE</button>
    <p id="toggle-text" style="font-size:12px; text-align:center; color:#888; margin-top:15px;">New to Loyal Fashion? <span style="color:var(--primary); font-weight:bold; cursor:pointer;" onclick="toggleAuth()">Create Account</span></p>
    <button onclick="closeLogin()" style="width:100%; background:none; border:none; margin-top:10px; cursor:pointer;">Close</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={ apiKey:"AIzaSyCax6078YpxQU0kHIChQLuEmpLUYXSxQr4", authDomain:"e-commerce-wepsite.firebaseapp.com", projectId:"e-commerce-wepsite", storageBucket:"e-commerce-wepsite.appspot.com", messagingSenderId:"394408704286", appId:"1:394408704286:web:9ad690a946b225ab20f10f" };
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();

let allProducts = []; 
let isLoginMode = true;

db.collection("products").orderBy("createdAt","desc").onSnapshot(snapshot=>{
    allProducts = [];
    snapshot.forEach(docSnap => {
        allProducts.push({ id: docSnap.id, ...docSnap.data() });
    });
    renderProducts(allProducts);
});

function renderProducts(products) {
    const list = document.getElementById("product-list");
    list.innerHTML = "";
    products.forEach(data => {
        const isInStock = data.inStock !== false;
        const outOfStockHTML = isInStock ? "" : `<div class="out-of-stock-badge">OUT OF STOCK</div>`;
        const imgClass = isInStock ? "" : "dim-image";
        const imgClick = isInStock ? `onclick="window.location.href='product-details.html?id=${data.id}'"` : "";
        const imgCursor = isInStock ? "pointer" : "not-allowed";
        const btnClass = isInStock ? "" : "disabled-btn";
        const btnActionCart = isInStock ? `onclick="addToCart('${data.id}','${data.productName}',${data.price},'${data.imageUrl}')"` : `disabled`;
        const btnActionBuy = isInStock ? `onclick="window.location.href='product-details.html?id=${data.id}'"` : `disabled`;
        const buyBtnText = isInStock ? 'BUY NOW' : 'UNAVAILABLE';
        const infoStyle = !isInStock ? 'color:#999;' : '';

        list.innerHTML += `
        <div class="product-card">
            ${outOfStockHTML}
            <img src="${data.imageUrl}" class="${imgClass}" ${imgClick} style="cursor:${imgCursor};">
            <div class="product-info">
                <div id="rate-${data.id}" class="rating-badge">‚≠ê Loading...</div>
                <h3 style="${infoStyle}">${data.productName}</h3>
                <p style="${infoStyle}">‚Çπ${data.price}</p>
                <div class="btn-group">
                    <button class="cart-add-btn ${btnClass}" ${btnActionCart}>ADD TO CART</button>
                    <button class="buy-now-btn ${btnClass}" ${btnActionBuy}">${buyBtnText}</button>
                </div>
            </div>
        </div>`;
        
        db.collection("reviews").where("productName", "==", data.productName).get().then(snap => {
            let total = 0;
            snap.forEach(r => total += r.data().rating);
            let avg = snap.size > 0 ? (total / snap.size).toFixed(1) : "0.0";
            const rateEl = document.getElementById(`rate-${data.id}`);
            if(rateEl) rateEl.innerText = `‚≠ê ${avg} (${snap.size})`;
        });
    });
}

window.filterCategory = function(cat) {
    if(cat === 'ALL') { renderProducts(allProducts); } 
    else { renderProducts(allProducts.filter(p => p.category === cat)); }
}

window.searchProducts = function() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    renderProducts(allProducts.filter(p => p.productName.toLowerCase().includes(term)));
}

auth.onAuthStateChanged(user=>{
    const loginBtn=document.getElementById("loginBtn");
    const userInfo=document.getElementById("userInfo");
    const count = JSON.parse(localStorage.getItem("cart"))?.length || 0;
    document.getElementById("cartCount").innerText = count;

    if(user && user.email !== "sureshrajagunam24@gmail.com"){
        loginBtn.style.display="none";
        userInfo.style.display="block";
        document.getElementById("userLetter").innerText = user.email.charAt(0).toUpperCase();
    } else {
        loginBtn.style.display="block";
        userInfo.style.display="none";
    }
});

function openProfile() {
    document.getElementById("profileSidebar").style.right = "0";
    document.getElementById("overlay").style.display = "block";
    const user = auth.currentUser;
    document.getElementById("sideLetter").innerText = user.email.charAt(0).toUpperCase();
    db.collection("users").doc(user.uid).get().then(doc => {
        if(doc.exists) {
            document.getElementById("sideName").value = doc.data().name || "";
            document.getElementById("sideMobile").value = doc.data().mobile || "";
            document.getElementById("sideAddress").value = doc.data().address || "";
        }
    });
}
function closeProfile() { 
    document.getElementById("profileSidebar").style.right = "-100%"; 
    document.getElementById("overlay").style.display = "none"; 
}
function saveProfile() {
    const user = auth.currentUser;
    const name = document.getElementById("sideName").value;
    const mobile = document.getElementById("sideMobile").value;
    const address = document.getElementById("sideAddress").value;
    db.collection("users").doc(user.uid).set({name, mobile, address, email:user.email}, {merge:true}).then(() => alert("Saved ‚úÖ"));
}
function openLogin() { document.getElementById("loginBox").style.display="block"; }
function closeLogin() { document.getElementById("loginBox").style.display="none"; }
function toggleAuth() {
    isLoginMode = !isLoginMode;
    const title = document.getElementById("auth-title");
    const btn = document.getElementById("auth-btn");
    const toggleText = document.getElementById("toggle-text");
    if (isLoginMode) {
        title.innerText = "Login"; btn.innerText = "CONTINUE";
        toggleText.innerHTML = 'New to Loyal Fashion? <span style="color:var(--primary); font-weight:bold; cursor:pointer;" onclick="toggleAuth()">Create Account</span>';
    } else {
        title.innerText = "Create Account"; btn.innerText = "REGISTER";
        toggleText.innerHTML = 'Already have an account? <span style="color:var(--primary); font-weight:bold; cursor:pointer;" onclick="toggleAuth()">Login</span>';
    }
}
function handleAuth() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    if (!email || !password) { alert("Please fill all fields!"); return; }
    if (isLoginMode) {
        auth.signInWithEmailAndPassword(email, password).then(() => location.reload()).catch(err => alert(err.message));
    } else {
        auth.createUserWithEmailAndPassword(email, password).then(() => { alert("Account Created! ‚úÖ"); location.reload(); }).catch(err => alert(err.message));
    }
}

window.addToCart = function(id,name,price,image){
    const user = auth.currentUser;
    if(!user) { openLogin(); return; }
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.push({id,name,price,image});
    localStorage.setItem("cart",JSON.stringify(cart));
    document.getElementById("cartCount").innerText=cart.length;
    alert("Added to Cart ‚úÖ");
}
</script>
</body>
</html>
