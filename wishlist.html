<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist - Loyal Fashion</title>
    <style>
        :root { --primary: #ff3f6c; --dark: #282c3f; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; margin: 0; padding: 20px; }
        
        .header { background: #fff; padding: 15px 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-radius: 8px; margin-bottom: 30px; }
        .header h2 { margin: 0; color: var(--dark); }
        .back-btn { background: #fff; color: var(--primary); border: 2px solid var(--primary); padding: 8px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .back-btn:hover { background: var(--primary); color: #fff; }
        
        .wishlist-container { max-width: 1200px; margin: 0 auto; }
        .wish-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; }
        
        .wish-card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; position: relative; text-align: center; border: 1px solid transparent; }
        .wish-card:hover { transform: translateY(-5px); border: 1px solid #eee; }
        .wish-card img { width: 100%; height: 300px; object-fit: cover; }
        
        .wish-info { padding: 15px; }
        .wish-info h3 { margin: 0 0 10px 0; font-size: 16px; color: var(--dark); }
        
        .remove-btn { position: absolute; top: 10px; right: 10px; background: #fff; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; color: #ff4d4d; font-weight: bold; box-shadow: 0 3px 8px rgba(0,0,0,0.15); transition: 0.3s; }
        .remove-btn:hover { background: #ff4d4d; color: #fff; }
        
        .view-product-btn { background: var(--dark); color: #fff; border: none; width: 100%; padding: 15px; font-weight: bold; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .view-product-btn:hover { background: #000; }
        
        .empty-msg { grid-column: 1 / -1; text-align: center; padding: 80px 20px; background: #fff; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .empty-msg h3 { color: var(--dark); margin-bottom: 10px; font-size: 22px; }
        .empty-msg p { color: #888; margin-bottom: 20px; }
        .shop-now-btn { background: var(--primary); color: #fff; border: none; padding: 12px 25px; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* =========================================
           MASS UPDATE: MOBILE RESPONSIVE DESIGN üì±
           ========================================= */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .header { padding: 15px; flex-direction: column; gap: 15px; text-align: center; margin-bottom: 15px; }
            .wish-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
            .wish-card img { height: 220px; }
            .empty-msg { padding: 40px 15px; }
            .empty-msg h3 { font-size: 18px; }
        }
    </style>
</head>
<body>

<div class="wishlist-container">
    <div class="header">
        <h2>‚ù§Ô∏è My Favorites</h2>
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Store</button>
    </div>

    <div id="wishlistContainer" class="wish-grid">
        <p style="text-align:center; color:#666; width:100%;">Loading your favorites... ‚è≥</p>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCax6078YpxQU0kHIChQLuEmpLUYXSxQr4",
    authDomain: "e-commerce-wepsite.firebaseapp.com",
    projectId: "e-commerce-wepsite",
    storageBucket: "e-commerce-wepsite.appspot.com",
    messagingSenderId: "394408704286",
    appId: "1:394408704286:web:9ad690a946b225ab20f10f"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

auth.onAuthStateChanged(user => {
    if (!user) { 
        document.getElementById("wishlistContainer").innerHTML = `
            <div class='empty-msg'>
                <h3>Login Required üë§</h3>
                <p>Please login to view your wishlist items.</p>
                <button class="shop-now-btn" onclick="window.location.href='index.html'">Go to Home</button>
            </div>`;
        return; 
    }

    // Fetch Wishlist items for current user
    db.collection("wishlist")
      .where("user", "==", user.email)
      .onSnapshot(snapshot => {
          const container = document.getElementById("wishlistContainer");
          container.innerHTML = "";

          if (snapshot.empty) {
              container.innerHTML = `
                <div class='empty-msg'>
                    <h3>Your wishlist is empty! ‚ù§Ô∏è</h3>
                    <p>Start saving your favorite items to view them here.</p>
                    <button class="shop-now-btn" onclick="window.location.href='index.html'">Explore Products</button>
                </div>`;
              return;
          }

          snapshot.forEach(docSnap => {
              const data = docSnap.data();
              const wishId = docSnap.id;

              container.innerHTML += `
              <div class="wish-card">
                  <button class="remove-btn" title="Remove" onclick="removeFromWishlist('${wishId}')">‚úñ</button>
                  <img src="${data.imageUrl}" alt="${data.productName}">
                  <div class="wish-info">
                      <h3>${data.productName}</h3>
                  </div>
                  <button class="view-product-btn" onclick="goToProduct('${data.productName}')">VIEW PRODUCT</button>
              </div>`;
          });
      });
});

/* REMOVE FROM WISHLIST */
window.removeFromWishlist = async function(id) {
    if(confirm("Remove this item from your favorites? üíî")) {
        await db.collection("wishlist").doc(id).delete();
    }
}

/* SMART NAVIGATION LOGIC: Find product ID by Name and go to Details Page */
window.goToProduct = async function(productName) {
    try {
        const snap = await db.collection("products").where("productName", "==", productName).get();
        if(!snap.empty) {
            const productId = snap.docs[0].id;
            window.location.href = `product-details.html?id=${productId}`;
        } else {
            alert("Oops! This product is currently unavailable. ‚ùå");
        }
    } catch(err) {
        alert("Error finding product: " + err.message);
    }
}
</script>
</body>
</html>
