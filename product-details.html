<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Utra Fashion</title>

    <style>
        :root { --primary:#ff3f6c; --dark:#111; }

        body{
            font-family:'Segoe UI',sans-serif;
            margin:0;
            background:#fff;
            padding:20px;
        }

        .details-container{
            display:flex;
            gap:30px;
            max-width:1200px;
            margin:30px auto;
            flex-wrap:wrap;
        }

        .gallery-section{
            display:flex;
            gap:15px;
            min-width:500px;
        }

        .thumbnail-column{
            display:flex;
            flex-direction:column;
            gap:10px;
            width:80px;
        }

        .thumb-img{
            width:70px;
            height:90px;
            object-fit:cover;
            cursor:pointer;
            border:1px solid #eee;
            border-radius:4px;
        }

        .thumb-img.active{
            border:2px solid var(--primary);
        }

        .image-zoom-container{
            position:relative;
            width:450px;
            height:550px;
            overflow:hidden;
            border-radius:8px;
            border:1px solid #eee;
            cursor:zoom-in;
        }

        .image-zoom-container img{
            width:100%;
            height:100%;
            object-fit:contain;
            transition:transform 0.3s ease;
        }

        .image-zoom-container:hover img{
            transform:scale(1.8);
        }

        .details-section{
            flex:1;
            min-width:300px;
        }

        .details-section h1{
            font-size:26px;
            margin:0 0 10px;
        }

        .price{
            font-size:24px;
            font-weight:bold;
            margin-bottom:10px;
        }

        .rating-badge{
            background:#e8f5e9;
            color:#2e7d32;
            padding:5px 10px;
            border-radius:4px;
            font-weight:bold;
            display:inline-block;
            margin-bottom:20px;
        }

        .size-options{
            display:flex;
            gap:10px;
            margin-top:10px;
        }

        .size-btn{
            padding:8px 15px;
            border:1px solid #ddd;
            background:#fff;
            cursor:pointer;
            border-radius:4px;
        }

        .size-btn.active{
            background:var(--dark);
            color:#fff;
        }

        .btn-group{
            display:flex;
            gap:15px;
            margin-top:30px;
        }

        .btn-group button{
            flex:1;
            padding:15px;
            font-weight:bold;
            border-radius:5px;
            cursor:pointer;
        }

        .add-cart{
            background:#fff;
            border:1px solid #000;
        }

        .buy-now{
            background:#000;
            color:#fff;
            border:none;
        }

        .reviews-container{
            max-width:1200px;
            margin:40px auto;
            padding:20px;
            background:#fafafa;
            border-radius:12px;
        }

        .review-card{
            border-bottom:1px solid #eee;
            padding:15px 0;
        }

        .related-container{
            max-width:1200px;
            margin:40px auto;
            padding:20px;
            border-top:6px solid #f5f5f6;
        }

        .related-scroll{
            display:flex;
            gap:15px;
            overflow-x:auto;
        }

        .related-card{
            min-width:160px;
            border:1px solid #eee;
            padding:10px;
            border-radius:8px;
            cursor:pointer;
        }

        .related-card img{
            width:100%;
            height:200px;
            object-fit:cover;
            border-radius:6px;
        }

        @media(max-width:768px){
            .details-container{flex-direction:column;}
            .gallery-section{flex-direction:column-reverse;min-width:100%;}
            .thumbnail-column{flex-direction:row;width:100%;overflow-x:auto;}
            .image-zoom-container{width:100%;height:400px;}
            .btn-group{flex-direction:column;}
        }
    </style>
</head>

<body>

<div style="max-width:1200px;margin:0 auto;">
    <a href="index.html" style="color:#ff3f6c;font-weight:bold;text-decoration:none;">
        ‚Üê Back to Utra Fashion
    </a>
</div>

<div class="details-container">
    <div class="gallery-section">
        <div class="thumbnail-column" id="thumbnail-list"></div>
        <div class="image-zoom-container">
            <img id="mainImg" src="">
        </div>
    </div>

    <div class="details-section">
        <div id="p-rating" class="rating-badge">‚≠ê 0.0 (0 Reviews)</div>
        <h1 id="p-name">Product Name</h1>
        <div class="price" id="p-price">‚Çπ0</div>

        <div id="size-area">
            <b>Select Size</b>
            <div class="size-options" id="size-list"></div>
        </div>

        <div style="margin-top:20px;">
            <b>Product Details</b>
            <p id="p-desc" style="color:#666;"></p>
        </div>

        <div class="btn-group">
            <button class="add-cart" onclick="addToCart()">ADD TO CART</button>
            <button class="buy-now" onclick="prepareBuy()">BUY NOW</button>
        </div>
    </div>
</div>

<div class="reviews-container">
    <h2>Customer Reviews ‚≠ê</h2>
    <div id="reviews-list">
        <p style="color:#888;">No reviews yet. ‚è≥</p>
    </div>
</div>

<div class="related-container">
    <h2>You May Also Like</h2>
    <div class="related-scroll" id="related-list"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey:"AIzaSyCax6078YpxQU0kHIChQLuEmpLUYXSxQr4",
        authDomain:"e-commerce-wepsite.firebaseapp.com",
        projectId:"e-commerce-wepsite",
        storageBucket:"e-commerce-wepsite.appspot.com",
        messagingSenderId:"394408704286",
        appId:"1:394408704286:web:9ad690a946b225ab20f10f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    let productData = {};
    let selectedSize="";

    if(productId){
        db.collection("products").doc(productId).get().then(doc=>{
            if(doc.exists){
                productData = doc.data();

                // UI data set pannunga
                document.getElementById("p-name").innerText = productData.productName;
                document.getElementById("p-price").innerText = "‚Çπ"+productData.price;
                document.getElementById("p-desc").innerText = productData.description || "Premium quality material. Utra Fashion Exclusive Collection.";
                document.getElementById("mainImg").src = productData.imageUrl || "https://via.placeholder.com/400x500?text=No+Image";

                // DATA READY AANA APRUM REVIEWS & RELATED FETCH PANNUNGA (Fixes undefined error)
                loadReviews();
                loadRelated(productData.category);

                // Sizes
                if(productData.sizes){
                    document.getElementById("size-list").innerHTML = "";
                    productData.sizes.forEach(size=>{
                        document.getElementById("size-list").innerHTML += `<button class="size-btn" onclick="selectSize(this,'${size}')">${size}</button>`;
                    });
                }else{
                    document.getElementById("size-area").style.display="none";
                }

                // Gallery
                const images=[productData.imageUrl, productData.imageUrl2, productData.imageUrl3];
                document.getElementById("thumbnail-list").innerHTML = "";
                images.forEach((img,i)=>{
                    if(img){
                        document.getElementById("thumbnail-list").innerHTML += `<img src="${img}" class="thumb-img ${i===0?'active':''}" onclick="changeImg(this,'${img}')">`;
                    }
                });
            }
        });
    }

    function loadReviews() {
        if(!productData.productName) return; // Prevent error
        db.collection("reviews").where("productName", "==", productData.productName).onSnapshot(snap => {
            const list = document.getElementById("reviews-list");
            list.innerHTML = "";
            let total = 0;
            snap.forEach(doc => {
                const r = doc.data();
                total += r.rating;
                list.innerHTML += `<div class="review-card"><b>${r.userName}</b><div>${"‚≠ê".repeat(r.rating)}</div><p>${r.comment}</p></div>`;
            });
            let avg = snap.size > 0 ? (total / snap.size).toFixed(1) : "0.0";
            document.getElementById("p-rating").innerText = `‚≠ê ${avg} (${snap.size} Reviews)`;
        });
    }

    function loadRelated(cat){
        if(!cat) return; // Prevent error
        db.collection("products").where("category","==",cat).limit(6).get().then(snap=>{
            const list = document.getElementById("related-list");
            list.innerHTML = "";
            snap.forEach(doc=>{
                if(doc.id!==productId){
                    const d=doc.data();
                    list.innerHTML += `<div class="related-card" onclick="window.location.href='product-details.html?id=${doc.id}'"><img src="${d.imageUrl}"><h4>${d.productName}</h4><b>‚Çπ${d.price}</b></div>`;
                }
            });
        });
    }

    function selectSize(btn,size){
        selectedSize=size;
        document.querySelectorAll(".size-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
    }

    function changeImg(el,src){
        document.getElementById("mainImg").src=src;
        document.querySelectorAll(".thumb-img").forEach(t=>t.classList.remove("active"));
        el.classList.add("active");
    }

    function addToCart(){
        let cart=JSON.parse(localStorage.getItem("cart"))||[];
        cart.push({ id:productId, name:productData.productName, price:productData.price, image:productData.imageUrl, size:selectedSize||"Free Size", qty:1 });
        localStorage.setItem("cart",JSON.stringify(cart));
        alert("Added to Cart üõí - Utra Fashion");
    }

    function prepareBuy(){
        const item={ productId:productId, productName:productData.productName, price:productData.price, imageUrl:productData.imageUrl, size:selectedSize||"Free Size" };
        localStorage.setItem("directBuy",JSON.stringify(item));
        window.location.href="checkout.html";
    }
</script>

</body>
</html>
